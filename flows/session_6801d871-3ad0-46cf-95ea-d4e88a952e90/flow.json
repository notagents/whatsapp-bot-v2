{
  "mode": "fsm",
  "initialState": "START",
  "states": {
    "START": {
      "reply": "Hola! Soy Cami de Astro, en que te ayudo?",
      "transitions": [{ "match": { "any": true }, "next": "ROUTER" }]
    },

    "ROUTER": {
      "router": {
        "type": "ai",
        "model": "gpt-4o-mini",
        "temperature": 0.3,
        "routes": [
          {
            "next": "SALUDO_HOLA_CAMI",
            "description": "Usuario saluda específicamente a 'Cami'",
            "examples": ["hola cami", "buenas cami"]
          },
          {
            "next": "SALUDO_HOLA",
            "description": "Saludo general del usuario",
            "examples": ["hola", "buenos días", "buenas"]
          },
          {
            "next": "ESCALATE",
            "name": "Escalamiento a humano",
            "description": "Consultas que requieren intervención humana: estado o seguimiento de pedido, reclamos, pago no acreditado, mayoristas, reventa, factura A, garantía compleja (reclamo vapo/semillas)",
            "examples": [
              "donde esta mi pedido",
              "numero de orden",
              "no me acreditaron el pago",
              "quiero hablar con alguien"
            ],
            "keywords": [
              "estado del pedido",
              "seguimiento",
              "reclamo",
              "mayorista",
              "reventa",
              "factura a"
            ]
          },
          {
            "next": "OFFTOPIC",
            "description": "Temas off-topic no relacionados con el negocio (transporte público, clima, política)",
            "keywords": ["bondi", "colectivo", "subte", "clima", "politica"]
          },
          {
            "next": "CAT1_SEMILLAS_P1",
            "name": "Semillas y Genéticas",
            "description": "Consultas sobre semillas de cannabis, genéticas, cepas, strains, feminizadas, indica/sativa",
            "examples": [
              "quiero comprar semillas",
              "que geneticas tienen",
              "semillas feminizadas"
            ],
            "keywords": [
              "semilla",
              "genetica",
              "cepa",
              "strain",
              "fem",
              "indica",
              "sativa"
            ]
          },
          {
            "next": "CAT2_SUSTRATOS",
            "name": "Sustratos y Tierra",
            "description": "Consultas sobre sustratos, tierra, coco, perlita, turba, vermiculita",
            "keywords": [
              "sustrato",
              "tierra",
              "coco",
              "perlita",
              "turba",
              "vermiculita"
            ]
          },
          {
            "next": "CAT3_FERTILIZANTES",
            "name": "Fertilizantes y Nutrientes",
            "description": "Consultas sobre fertilizantes, nutrientes, abonos, productos flora/vege, tripacks",
            "keywords": [
              "fertilizante",
              "nutriente",
              "abono",
              "flora",
              "vege",
              "tripack"
            ]
          },
          {
            "next": "CAT4_ILUMINACION",
            "name": "Iluminación",
            "description": "Consultas sobre luces de cultivo, LED, paneles, galponeras, balastros, quantum boards",
            "keywords": [
              "luz",
              "led",
              "panel",
              "galponera",
              "balastro",
              "quantum"
            ]
          },
          {
            "next": "CAT5_CARPAS",
            "name": "Carpas Indoor",
            "description": "Consultas sobre carpas de cultivo, grow tents, armarios indoor",
            "keywords": ["carpa", "indoor", "armario", "grow tent"]
          },
          {
            "next": "CAT6_VENTILACION",
            "name": "Ventilación",
            "description": "Consultas sobre extractores, ventilación, filtros de olor, carbón activado",
            "keywords": [
              "extractor",
              "ventilacion",
              "filtro olor",
              "carbon activado"
            ]
          },
          {
            "next": "CAT7_PLAGAS",
            "name": "Control de Plagas",
            "description": "Consultas sobre plagas, neem, araña roja, trips, fungicidas, insecticidas",
            "keywords": [
              "plaga",
              "neem",
              "arana roja",
              "trips",
              "fungicida",
              "insecticida"
            ]
          },
          {
            "next": "CAT8_ACCESORIOS",
            "name": "Accesorios de Cultivo",
            "description": "Consultas sobre macetas, medidores de pH, tijeras, timers, termómetros",
            "keywords": ["maceta", "ph", "tijera", "timer", "termometro"]
          },
          {
            "next": "CAT9_SETUP",
            "name": "Setup Inicial",
            "description": "Usuarios principiantes que quieren empezar a cultivar por primera vez, buscan kits completos",
            "examples": [
              "quiero empezar a cultivar",
              "primera vez cultivo",
              "que necesito para empezar"
            ],
            "keywords": [
              "empezar",
              "primera vez",
              "kit",
              "que necesito",
              "setup"
            ]
          },
          {
            "next": "CAT11_ASESORAMIENTO",
            "name": "Asesoramiento Técnico",
            "description": "Problemas con plantas existentes, hojas amarillas, diagnóstico de cultivo",
            "examples": [
              "mi planta tiene hojas amarillas",
              "problema con el cultivo"
            ],
            "keywords": ["hojas amarillas", "mi planta", "problema"]
          },
          {
            "next": "CAT12_VAPOS",
            "name": "Vaporizadores",
            "description": "Consultas sobre vaporizadores, vapes",
            "keywords": ["vaporizador", "vapo", "vape"]
          },
          {
            "next": "INFO_KB",
            "name": "Información General",
            "description": "Información institucional de la tienda: dirección, horarios, envíos, métodos de pago (cuotas, transferencia, efectivo), políticas de garantía y devolución, cómo hacer un pedido. No es reclamo ni estado de pedido.",
            "examples": [
              "donde están ubicados",
              "que horario tienen",
              "hacen envios",
              "formas de pago",
              "como pago",
              "cuotas sin interes",
              "como hago un pedido",
              "politica de garantia"
            ],
            "keywords": [
              "direccion",
              "horarios",
              "envio",
              "pago",
              "garantia",
              "ubicacion",
              "local",
              "retiro",
              "transferencia",
              "cuotas"
            ]
          },
          {
            "next": "DESPEDIDA",
            "name": "Despedida",
            "description": "Usuario se despide, agradece, indica que no necesita nada mas o que la conversacion termina",
            "examples": [
              "gracias",
              "chau",
              "nos vemos",
              "listo gracias",
              "no necesito nada mas",
              "perfecto gracias"
            ],
            "keywords": [
              "gracias",
              "chau",
              "adios",
              "hasta luego",
              "nos vemos",
              "listo",
              "dale"
            ]
          },
          {
            "next": "NO_CLARO",
            "description": "Fallback cuando no se puede clasificar con confianza el mensaje"
          }
        ],
        "defaultRoute": "NO_CLARO"
      }
    },

    "SALUDO_HOLA_CAMI": {
      "reply": "Hola! En que puedo ayudarte con Astro Grow hoy?",
      "transitions": [{ "match": { "any": true }, "next": "ROUTER" }]
    },

    "SALUDO_HOLA": {
      "reply": "Hola! Aqui Cami de Astro! En que puedo ayudarte hoy?",
      "transitions": [{ "match": { "any": true }, "next": "ROUTER" }]
    },

    "OFFTOPIC": {
      "reply": "Perdon, con eso no te puedo ayudar por aca. Que necesitas ver de cultivo o productos de Astro Grow hoy?",
      "transitions": [{ "match": { "any": true }, "next": "ROUTER" }]
    },

    "ESCALATE": {
      "reply": "Dale, con eso te ayuda mejor alguien del equipo. Me decis tu numero de orden o algun dato del pedido?",
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "NO_CLARO": {
      "reply": "Perdon, no llegue a entender bien. Me contas que estas buscando?",
      "transitions": [{ "match": { "any": true }, "next": "ROUTER" }]
    },

    "CAT1_SEMILLAS_P1": {
      "reply": "Dale, para ayudarte bien primero necesito esto. Vas a cultivar en interior o exterior?",
      "transitions": [
        { "match": { "any": true }, "next": "CAT1_SEMILLAS_P1_ROUTER" }
      ]
    },

    "CAT1_SEMILLAS_P1_ROUTER": {
      "router": {
        "type": "keyword",
        "routes": [
          { "keyword": "interior", "next": "CAT1_SEMILLAS_P2" },
          { "keyword": "indoor", "next": "CAT1_SEMILLAS_P2" },
          { "keyword": "carpa", "next": "CAT1_SEMILLAS_P2" },
          { "keyword": "placard", "next": "CAT1_SEMILLAS_P2" },

          { "keyword": "exterior", "next": "CAT1_SEMILLAS_P2" },
          { "keyword": "afuera", "next": "CAT1_SEMILLAS_P2" },
          { "keyword": "balcon", "next": "CAT1_SEMILLAS_P2" },
          { "keyword": "patio", "next": "CAT1_SEMILLAS_P2" },

          { "default": true, "next": "CAT1_SEMILLAS_P1_REPEAT" }
        ]
      }
    },

    "CAT1_SEMILLAS_P1_REPEAT": {
      "reply": "Perfecto, para ubicarte bien necesito una cosa. Es interior o exterior?",
      "transitions": [
        { "match": { "any": true }, "next": "CAT1_SEMILLAS_P1_ROUTER" }
      ]
    },

    "CAT1_SEMILLAS_P2": {
      "reply": "Genial. Las automaticas florecen solas por tiempo, las fotoperiodicas dependen de las horas de luz. Cual preferis, automatica o fotoperiodica?",
      "transitions": [
        { "match": { "any": true }, "next": "CAT1_SEMILLAS_P2_ROUTER" }
      ]
    },

    "CAT1_SEMILLAS_P2_ROUTER": {
      "router": {
        "type": "keyword",
        "routes": [
          { "keyword": "auto", "next": "CAT1_SEMILLAS_RECOMMEND" },
          { "keyword": "automatica", "next": "CAT1_SEMILLAS_RECOMMEND" },
          { "keyword": "autofloreciente", "next": "CAT1_SEMILLAS_RECOMMEND" },

          { "keyword": "foto", "next": "CAT1_SEMILLAS_RECOMMEND" },
          { "keyword": "fotoperiodica", "next": "CAT1_SEMILLAS_RECOMMEND" },
          { "keyword": "fotoperiodo", "next": "CAT1_SEMILLAS_RECOMMEND" },

          { "keyword": "no se", "next": "CAT1_SEMILLAS_RECOMMEND" },
          { "default": true, "next": "CAT1_SEMILLAS_P2_REPEAT" }
        ]
      }
    },

    "CAT1_SEMILLAS_P2_REPEAT": {
      "reply": "Dale, asi te recomiendo bien. Preferis automatica o fotoperiodica?",
      "transitions": [
        { "match": { "any": true }, "next": "CAT1_SEMILLAS_P2_ROUTER" }
      ]
    },

    "CAT1_SEMILLAS_RECOMMEND": {
      "agent": "cami_recommender",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT2_SUSTRATOS": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT3_FERTILIZANTES": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT4_ILUMINACION": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT5_CARPAS": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT6_VENTILACION": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT7_PLAGAS": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT8_ACCESORIOS": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT9_SETUP": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT11_ASESORAMIENTO": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "CAT12_VAPOS": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "INFO_KB": {
      "agent": "cami_default",
      "kbV2": { "md": { "enabled": true, "topK": 4 } },
      "transitions": [{ "match": { "any": true }, "next": "ROUTER" }]
    },

    "DESPEDIDA": {
      "reply": "De nada! Cualquier cosa escribime. Buen dia!",
      "transitions": [{ "match": { "any": true }, "next": "END" }]
    },

    "END": {
      "end": true
    }
  }
}
